<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="team01.yaksutor.pharmacy.mapper.PhBoardMapper">


    <!--커뮤니티-->
    <resultMap type="Board" id="boardResultMap">
        <id column="cm_num" 			property="boardCode" />
        <result column="m_id" 		property="mId"/>
        <result column="cm_title" 		property="boardTitle"/>
        <result column="cm_content" 		property="boardContent"/>
        <result column="cm_date" 	property="boardDate"/>
    </resultMap>


    <select id="getBoardList" resultMap="boardResultMap">
        /* 게시판 목록 */
        SELECT
            cm_num,
            m_id,
            cm_title,
            cm_content,
            cm_date
        FROM
            community;
    </select>


    <!--자주하는 질문-->
    <resultMap type="QuestionCenter" id="questionCenterResultMap">

        <id column="question_num" 			property="questionNum" />
        <result column="m_id" 			property="mId" />
        <result column="question_title" 		property="questionTitle"/>
        <result column="question_content" 		property="questionContent"/>
        <result column="question_date" 	property="questionDate"/>
    </resultMap>


    <select id="getQuestionCenterList" resultMap="questionCenterResultMap">
        SELECT
            question_num,
            m_id,
            question_title,
            question_content,
            question_date
        FROM
            question_center;
    </select>

    <insert id="addQuestionCenter" parameterType="QuestionCenter">
        <selectKey keyProperty="questionNum" resultType="String" order="BEFORE">
            SELECT
            CASE
            WHEN COUNT(question_num) = 0 THEN 'ques_1'
            ELSE
            CONCAT(
            'ques_',
            MAX(CAST(SUBSTRING_INDEX(question_num, 'ques_', -1) AS UNSIGNED)) +1)
            END AS questionNum
            FROM
            question_center;
        </selectKey>

        /* 등록 */
        INSERT INTO question_center
        (question_num, m_id, question_title, question_content, question_date)
        values
        (#{questionNum}, #{mId}, #{questionTitle}, #{questionContent}, CURDATE());

    </insert>

    <delete id="removeQuestionCenterByNum" parameterType="String">
        /*  삭제 */
        DELETE
        FROM
            question_center
        WHERE
            question_num = #{questionNum};
    </delete>


    <!--공지사항-->
    <resultMap type="Notice" id="noticeResultMap">
        <id column="notice_num" 			property="noticeNum" />
        <result column="m_id" 		property="mId"/>
        <result column="notice_title" 		property="noticeTitle"/>
        <result column="notice_content" 		property="noticeContent"/>
        <result column="notice_view" 	property="noticeView"/>
        <result column="notice_date" 	property="noticeDate"/>
    </resultMap>

    <select id="getNoticeList" resultMap="noticeResultMap">
        SELECT
            notice_num,
            m_id,
            notice_title,
            notice_content,
            notice_view,
            notice_date
        FROM
            notice_center;
    </select>
    <insert id="addNotice" parameterType="Notice">
        <selectKey keyProperty="noticeNum" resultType="String" order="BEFORE">
            SELECT
            CASE
            WHEN COUNT(notice_num) = 0 THEN 'noti_1'
            ELSE
            CONCAT(
            'noti_',
            MAX(CAST(SUBSTRING_INDEX(notice_num, 'noti_', -1) AS UNSIGNED)) +1)
            END AS noticeNum
            FROM
            notice_center;
        </selectKey>

        /* 등록 */
        INSERT INTO notice_center
        (notice_num, m_id, notice_title, notice_content, notice_view, notice_date)
        values
        (#{noticeNum}, #{mId}, #{noticeTitle}, #{noticeContent}, #{noticeView}, CURDATE());

    </insert>

</mapper>